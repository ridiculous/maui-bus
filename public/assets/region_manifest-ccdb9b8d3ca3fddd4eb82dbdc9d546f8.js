function StaticMap(){var t=this;this.$modal=document.getElementById("mba_modal"),this.$modal_body=document.getElementById("modal_body"),this.map_url="http://maps.googleapis.com/maps/api/staticmap?zoom=16&size=530x400&maptype=roadmap&sensor=false&markers=color:green%7C",this.init=function(){var e=this.rel,n=t.map_url;n+=e,n+="&center="+e,t.$modal_body.innerHTML='<img src="'+n+'" width="530" height="400" />',t.$modal.className="modal",setTimeout(function(){jUtils.addEvent(document,"keyup",t.hideModalIf)},300)},this.hideModal=function(){jUtils.removeEvent(document,"keyup",t.hideModalIf),t.$modal.className+=" fade",setTimeout(function(){t.$modal.className+=" hide"},500)},this.hideModalIf=function(e){27===jUtils.getEvent(e).keyCode&&t.hideModal()}}function Toggler(){this.tableToggle=function(){var t=this.className.split(/\s+/),e=t.find("active"),n=this.rel,i=document.getElementById(n+"_container");return-1===e?(this.className+=" active",i.style.display="block"):(t.splice(e,1),this.className=t.join(" "),i.style.display="none"),!1},this.nextStopsToggle=function(){var t=this.className.split(/\s+/),e=t.find("active"),n=document.getElementById(this.rel);jUtils.hasClass(n,"hidden-phone")?(this.className+=" active",n.className=""):(n.className="hidden-phone hidden-tablet",t.splice(e,1),this.className=t.join(" "))}}function BusSchedule(){this.schedule=[],this.route_name="",this.init=function(t){this.route_name=t;for(var e,n=document.getElementById(this.route_name+"_table"),i=0;e=n.rows[i];i++)for(var s,o=1;s=e.cells[o];o++){var a=o-1,r=s.innerHTML.replace(/\d+|\s+|:/g,"");this.schedule[a]||(this.schedule[a]=[]),r&&-1===this.schedule[a].find(r)&&this.schedule[a].push(r)}},this.toggleAM=function(t){return this.toggler("AM",t),this},this.togglePM=function(t){return this.toggler("PM",t),this},this.toggler=function(t,e){for(var n=0;n<this.schedule.length;n++)if(1===this.schedule[n].length&&this.schedule[n][0]===t)for(var i=0,s=jUtils.findByClass(this.route_name+"-time-cell-"+n);i<s.length;i++)s[i].style.display=e}}function changeTimeFrame(){var t=this.rel,e=this.parentElement,n=e,i=e,s=Schedules[t];if(t){for(s||(s=new BusSchedule,s.init(t),Schedules[t]=s),e.className="active";i=i.nextSibling;)i.className="";for(;n=n.previousSibling;)n.className="";jUtils.hasClass(this,"morning")?s.toggleAM("table-cell").togglePM("none"):jUtils.hasClass(this,"afternoon")?s.toggleAM("none").togglePM("table-cell"):s.toggleAM("table-cell").togglePM("table-cell")}}if(Number.prototype.timesDo=function(t){if(t)for(var e=0;this>e;e++)t.call()},String.prototype.squeeze=function(){return this.replace(/\s+/g,"")},String.prototype.pluralize=function(t){var e="s";return 1==t&&(e=""),this+e},Array.prototype.compacted=function(){for(var t=[],e=0;e<this.length;e++)void 0!==this[e]&&null!==this[e]&&this[e]!==!1&&t.push(this[e]);return t},Array.prototype.find=function(t){for(var e=-1,n=0;n<this.length;n++)this[n]==t&&(e=n);return e},Array.prototype.findObject=function(t,e){for(var n=null,i=0;i<this.length;i++)this[i][e]==t&&(n=this[i]);return n},Array.prototype.updateObject=function(t,e,n,i){for(var s=0;s<this.length;s++)if(this[s][e]==i)return this[s][n]=i},Array.prototype.findAndRemove=function(t){for(var e=0;e<this.length;e++)this[e]==t&&this.splice(e,1)},Array.prototype.findAndRemoveObject=function(t,e){for(var n=0;n<this.length;n++)this[n]&&this[n][e]==t&&this.splice(n,1)},!window.Prototype){Object.extend=function(t,e){for(var n in e)t[n]=e[n];return t};var $A=Array.from=function(t){if(!t)return[];if(t.toArray)return t.toArray();for(var e=[],n=0,i=t.length;i>n;n++)e.push(t[n]);return e};Function.prototype.bind=function(){var t=this,e=$A(arguments),n=e.shift();return function(){return t.apply(n,e.concat($A(arguments)))}};var Class={},Event={observe:function(t,e,n){try{t.addEventListener(e,n,!1)}catch(i){t.attachEvent("on"+e,n)}return t}}}Class.extend=function(t,e){return Object.extend(t.prototype,e.prototype),t.superclass=e,t};var EventDispatcher=function(){var t={},e=[];this.registerEvent=function(n){e.push(n),t[n]=[]},this.registerEvents=function(t){for(var e=0,n=t.length;n>e;e++)this.registerEvent(t[e])},this.getEventRoster=function(){return e},this.getListenerChain=function(){return t},this.addEventListener=function(e,n){return n instanceof Function?(t[e]?t[e].push(n):t[e]=[n],void 0):!1},this.hasEventListener=function(e){return"undefined"!=typeof t[e]&&t[e].length>0},this.removeEventListener=function(e,n){if(!this.hasEventListener(e))return!1;for(var i=0,s=t[e].length;s>i;i++)t[e][i]===n&&t[e].splice(i,1)},this.dispatchEvent=function(e,n){if(t[e])for(var i=0,s=t[e].length;s>i;i++)t[e][i](n)},this.once=function(t,e){var n=function(i){e(i),this.removeEventListener(t,n)}.bind(this);this.addEventListener(t,n)},this.on=this.addEventListener,this.un=this.removeEventListener,this.fire=this.dispatchEvent},AjaxService=function(t,e,n){function i(t,e,n){m.push({url:t,params:e,method:n})}function s(t){var e=[];if("string"==typeof t)return t;for(var n in t)e.push(encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return e.join("&")}function o(t){return t>=200&&300>t}function a(t,e,n){y=!0;var i=s(e),o=[n,t,i].join("");if(T&&v[o])return u(o),!0;var a=A();a.onreadystatechange=l.bind(g,a,o),"get"==n.toLowerCase()&&i.length>0&&(t+="?"+i),a.open(n,t,!0),c(a),a.parameters=i,g.dispatchEvent("uninitialized",a),a.send(i),E&&r(a)}function r(t){t.timeout=setTimeout(h.bind(this,t),E)}function c(t){for(var e in f)t.setRequestHeader(e,f[e])}function l(t,e){var n=M[t.readyState];try{if("complete"==n&&(clearTimeout(t.timeout),y=!1,T&&!v[e]&&(v[e]=t)),this.dispatchEvent(n,t),"complete"==n&&o(t.status)?this.dispatchEvent("success",t):"complete"!=n||o(t.status)||this.dispatchEvent("failure",t),"complete"==n&&b&&m.length>0){var i=m.shift();a(i.url,i.params,i.method)}}catch(s){this.dispatchEvent("exception",s)}}function h(t){try{t.abort(),this.dispatchEvent("timeout",t)}catch(e){t.exception=e,this.dispatchEvent("exception",t)}}function u(t){var e=v[t];setTimeout(function(){try{g.dispatchEvent("complete",e),g.dispatchEvent("success",e)}catch(t){g.dispatchException("exception",e,t)}},50)}AjaxService.superclass.call(this,null);var d={},f={},v={},m=[],p="",g=this,y=!1,E=!1,T=!1,b=n,j=!1,M=["uninitialized","loading","loaded","interactive","complete"];this.registerEvents(["success","failure","exception","timeout"].concat(M)),this.setMethod=function(t){p=t,"POST"==p.toUpperCase()&&this.setRequestHeader("Content-type","application/x-www-form-urlencoded")},this.enableHistory=function(t){var e=this.createHistory(t);e.enable()},this.disableHistory=function(){var t=this.createHistory();t.disable()},this.createHistory=function(){return j||(j=new AjaxHistory(this),j.on("change",g.send)),j},this.enableCache=function(){T=!0},this.disableCache=function(){T=!1},this.setParams=function(t){d=t},this.setTimeout=function(t){E=t},this.setSynchronous=function(t){b=t},this.getTimeout=function(){return E},this.setRequestHeader=function(t,e){f[t]=e},this.send=function(e){b&&y?i(t,e||d,p):a(t,e||d,p)};var A=function(){try{return new XMLHttpRequest}catch(t){try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){return new ActiveXObject("Microsoft.XMLHTTP")}}};this.setMethod(e||"POST"),this.getRawXHR=A};try{Class.extend(AjaxService,EventDispatcher)}catch(e){alert("Failed to extend class "+e.message)}var jUtils={addEvent:function(t,e,n){var i=function(t){t.addEventListener?t.addEventListener(e,n):t.attachEvent?t.attachEvent("on"+e,function(){n.call(this.target||this.event.srcElement)}):t[e]=n};if("undefined"!=typeof t[0])for(var s=0;s<t.length;s++)i(t[s]);else i(t)},removeEvent:function(t,e,n){t.removeEventListener?t.removeEventListener(e,n,!1):t.detachEvent?t.detachEvent("on"+e,n):t[e]=null},findByClass:function(t){return document.getElementsByClassName?document.getElementsByClassName(t):document.querySelectorAll("."+t)},hasClass:function(t,e){return t.classList?t.classList.contains(e):-1!==t.className.split(/\s+/).find(e)},fireEvent:function(t,e){if(document.createEvent){var n=document.createEvent("HTMLEvents");return n.initEvent(e,!0,!0),!t.dispatchEvent(n)}return t.fireEvent("on"+e,document.createEventObject())},getEvent:function(t){return t?t:window.event}},Schedules={},Toga=new Toggler;jUtils.addEvent(window,"load",function(){var t=jUtils.findByClass("time-list"),e=function(){if(document.getElementById(this.rel+"_container"))Toga.tableToggle.call(this);else{var t=this,e=this.rel.split("_"),n=e[0],i=e[1],s=document.createElement("div"),o=new AjaxService("/regions/"+n+"/routes/"+i+"/schedule","GET");s.innerHTML='<h5 class="loader">Loading ... </h5>',document.getElementById(this.rel).parentNode.appendChild(s),o.setRequestHeader("X-Requested-With","XMLHttpRequest"),o.on("success",function(e){s.innerHTML=e.responseText,Toga.tableToggle.call(t),s=document.getElementById(t.rel+"_container");for(var n=0,i=s.childNodes[1].childNodes;n<i.length;n++){var o=i[n].childNodes[0];"active"==i[n].className&&changeTimeFrame.call(o),jUtils.addEvent(o,"click",changeTimeFrame)}}),o.send()}};if(jUtils.addEvent(t,"click",e),jUtils.addEvent(jUtils.findByClass("next-stop-list"),"click",Toga.nextStopsToggle),!document.getElementById("delay")){jUtils.addEvent(jUtils.findByClass("time-frame"),"click",changeTimeFrame);for(var n=0,i=jUtils.findByClass("active");n<i.length;n++)changeTimeFrame.call(i[n].childNodes[0])}for(var s=0,o=jUtils.findByClass("icon");s<o.length;s++)o[s].className+=" icon-white";if(window.location.hash)for(var a=0;a<t.length;a++)"#"+t[a].rel==window.location.hash&&Toga.tableToggle.call(t[a]);else 1===t.length&&Toga.tableToggle.call(t[0])});