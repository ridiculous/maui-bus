var maui=new Maui,Locations=Locations||{};!function(){maui.gmap=new BaseMap({zoom:10,mapTypeId:google.maps.MapTypeId.ROADMAP,zoomControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT},panControl:!1}),maui.loadBusStops(Locations);var e=maui.gmap.map,t='<br /><a href="javascript:;" class="origin">Set as Origin</a><br /><a href="javascript:;" class="destination">Set as Destination</a>',o=function(){for(var o=[],n=maui.bus_stops,a=0;a<n.length;a++){var i=n[a];if(!i.hidden){var s={position:new google.maps.LatLng(i.lat,i.long),map:e,title:i.name};o.push(new SearchMarker(i.key,s,s.title+t))}}},n=document.getElementById("destination"),a=document.getElementById("origin"),i=document.getElementById("submit_search"),s=new AjaxService("/search","GET"),l=function(){try{var e=document.getElementById("search_box"),t=document.getElementById("map_canvas"),o=t.offsetHeight;e.offsetHeight>o-("scroll"==e.style.overflowY?54:40)?(e.style.maxHeight=o-75+"px",e.style.overflowY="scroll"):(e.style.maxHeight="",e.style.overflowY="")}catch(n){window.console&&console.log("Error setting height of search box! "+n)}};o(),e.setCenter(maui.gmap.Mall),e.setZoom(e.getZoom()+4),s.setRequestHeader("X-Requested-With","XMLHttpRequest"),s.on("success",function(e){document.getElementById("direct_routes").innerHTML=e.responseText,i.disabled=!1,i.value="Search",l()}),s.on("failure",function(e){var t=document.getElementById("direct_routes"),o="";o=e.status?"Oops, something went wrong ...":"Server can't be reached! Please check your connection.",t.innerHTML='<div class="error-text mini well mt10">'+o+"</div>",i.disabled=!1,i.value="Search"}),jUtils.addEvent(i,"click",function(e){var t=jUtils.getEvent(e);return this.value="Searching",this.disabled=!0,s.send({origin:a.value,destination:n.value}),window.location.hash=a.value+"-"+n.value,"function"==typeof t.preventDefault&&t.preventDefault(),!1});var r=window.location.hash.split("-");2===r.length&&(a.value=r[0].replace("#",""),n.value=r[1],s.send({origin:a.value,destination:n.value})),document.getElementById("is_desktop")&&l()}();