var maui=new Maui,Locations=Locations||{};!function(){maui.gmap=new BaseMap({zoom:10,mapTypeId:google.maps.MapTypeId.ROADMAP,zoomControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT},panControl:!1}),maui.loadBusStops(Locations);var e=maui.gmap.map,t='<br /><a href="javascript:;" class="origin">Set as Origin</a><br /><a href="javascript:;" class="destination">Set as Destination</a>',a=function(){for(var a=[],n=maui.bus_stops,o=0;o<n.length;o++){var i=n[o];if(!i.hidden){var s={position:new google.maps.LatLng(i.lat,i.long),map:e,title:i.name};a.push(new SearchMarker(i.key,s,s.title+t))}}},n=document.getElementById("destination"),o=document.getElementById("origin"),i=document.getElementById("search_time"),s=document.getElementById("submit_search"),l=new AjaxService("/search","GET"),r=function(){try{var e=document.getElementById("search_box"),t=document.getElementById("map_canvas"),a=t.offsetHeight;e.offsetHeight>a-("scroll"==e.style.overflowY?54:40)?(e.style.maxHeight=a-75+"px",e.style.overflowY="scroll"):(e.style.maxHeight="",e.style.overflowY="")}catch(n){window.console&&console.log("Error setting height of search box! "+n)}},c=function(){s.value="Searching",s.disabled=!0,l.send({origin:o.value,destination:n.value,search_time:i.value}),window.location.hash=o.value+"-"+n.value+"-"+i.value.replace(/\s/g,"_")};a(),e.setCenter(maui.gmap.Mall),e.setZoom(e.getZoom()+4),l.setRequestHeader("X-Requested-With","XMLHttpRequest"),l.on("success",function(e){document.getElementById("direct_routes").innerHTML=e.responseText,s.disabled=!1,s.value="Search",r()}),l.on("failure",function(e){var t=document.getElementById("direct_routes"),a="";a=e.status?"Oops, something went wrong ...":"Server can't be reached! Please check your connection.",t.innerHTML='<div class="error-text mini well mt10">'+a+"</div>",s.disabled=!1,s.value="Search"}),jUtils.addEvent(s,"click",function(e){var t=jUtils.getEvent(e);return c(),"function"==typeof t.preventDefault&&t.preventDefault(),!1});var u=window.location.hash.split("-");3===u.length&&(o.value=u[0].replace("#",""),n.value=u[1],i.value=u[2].replace(/_/g," "),l.send({origin:o.value,destination:n.value,search_time:i.value})),document.getElementById("is_desktop")&&r(),jUtils.addEvent([o,n,i],"change",function(){c()})}();