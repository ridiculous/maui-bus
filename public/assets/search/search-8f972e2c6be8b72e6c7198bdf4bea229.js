var maui=new Maui,Locations=Locations||{};!function(){maui.gmap=new BaseMap({zoom:10,mapTypeId:google.maps.MapTypeId.ROADMAP,zoomControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT},panControl:!1}),maui.loadBusStops(Locations);var e=maui.gmap.map,t='<br /><a href="javascript:;" class="origin">Set as Origin</a><br /><a href="javascript:;" class="destination">Set as Destination</a>',a=function(){for(var a=[],o=maui.bus_stops,n=0;n<o.length;n++){var i=o[n];if(!i.hidden){var s={position:new google.maps.LatLng(i.lat,i.long),map:e,title:i.name};a.push(new SearchMarker(i.key,s,s.title+t))}}},o=document.getElementById("destination"),n=document.getElementById("origin"),i=document.getElementById("submit_search"),s=new AjaxService("/search","GET"),r=function(){try{var e=document.getElementById("search_box"),t=document.getElementById("map_canvas"),a=t.offsetHeight-75;e.offsetHeight>a+25?(e.style.maxHeight=a+"px",e.style.overflowY="scroll"):(e.style.maxHeight="",e.style.overflowY="")}catch(o){window.console&&console.log("Error setting height of search box! "+o)}};a(),e.setCenter(maui.gmap.Mall),e.setZoom(e.getZoom()+4),s.setRequestHeader("X-Requested-With","XMLHttpRequest"),s.on("success",function(e){document.getElementById("direct_routes").innerHTML=e.responseText,i.disabled=!1,i.value="Search",r()}),s.on("error",function(){document.getElementById("direct_routes").innerHTML='<h3 class="error-text">Oops, an error has occured!</h3>',i.disabled=!1,i.value="Search"}),jUtils.addEvent(i,"click",function(e){var t=jUtils.getEvent(e);return this.value="Searching",this.disabled=!0,s.send({async:"1",origin:n.value,destination:o.value}),window.location.hash=n.value+"-"+o.value,"function"==typeof t.preventDefault&&t.preventDefault(),!1});var l=window.location.hash.split("-");2===l.length&&(n.value=l[0].replace("#",""),o.value=l[1],s.send({async:"1",origin:n.value,destination:o.value})),document.getElementById("is_desktop")&&r()}();